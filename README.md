# Spotify NowPlaying Sharing App

ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ã€Spotifyã§ç¾åœ¨å†ç”Ÿä¸­ã®æ›²ã‚„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’ã€ä»»æ„ã®Misskeyã‚µãƒ¼ãƒãƒ¼ã‚‚ã—ãã¯Twitter(è‡ªç§°:ğ•)ã«å…±æœ‰ã™ã‚‹ãŸã‚ã®Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

## æ¦‚è¦

Spotifyã®APIã‚’ä½¿ç”¨ã—ã¦ã€ç¾åœ¨å†ç”Ÿä¸­ã®æ›²ã‚„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã®æƒ…å ±ã‚’å–å¾—ã—ã¾ã™ã€‚  
ãã—ã¦ã€ç°¡å˜ã«å…±æœ‰ã§ãã‚‹ã‚ˆã†ã«ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆã—ã€Misskeyã‚‚ã—ãã¯Twitter(è‡ªç§°:ğ•)ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã›ã¾ã™ã€‚  

ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚¯ã«ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ãƒ†ã‚­ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ãŠã‚Šã€æ›²å, ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆå, #NowPlayingã‚’è‡ªã‚‰å…¥åŠ›ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```
ã‚ã¨ãŒã / æ¥æ –å¤èŠ½
#NowPlaying #PsrPlaying
https://open.spotify.com/track/5WehEFiES0ebVqgXpYQ8Fi
```

## æ©Ÿèƒ½

### ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…±æœ‰ï¼ˆå¾“æ¥æ©Ÿèƒ½ï¼‰

- `/note` - Misskeyå‘ã‘ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚¯ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- `/tweet` - Twitter(ğ•)å‘ã‘ã‚·ã‚§ã‚¢ãƒªãƒ³ã‚¯ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### APIç›´æ¥æŠ•ç¨¿ï¼ˆæ–°æ©Ÿèƒ½ï¼‰

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§Misskey/Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’é€£æºã—ã€APIãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã£ã¦ç›´æ¥æŠ•ç¨¿ãŒå¯èƒ½ã§ã™ã€‚

- **MiAuth** - Misskeyã‚¢ã‚«ã‚¦ãƒ³ãƒˆé€£æº
- **Twitter OAuth 2.0 PKCE** - Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆé€£æº
- **ãƒ˜ãƒƒãƒ€ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼** - ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§APIã«ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å±¤ã‚’è¿½åŠ 

## ãƒ‡ãƒ¢

Spotifyã§éŸ³æ¥½ã‚’å†ç”Ÿã—ãŸçŠ¶æ…‹ã§ã€[ã“ã“](https://spn.soli0222.com/tweet)ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã¦ãã ã•ã„ã€‚  
æ›²åã€ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆåãŒå…¥ã£ãŸçŠ¶æ…‹ã§ã€ç°¡å˜ã«å…±æœ‰ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
spotify-nowplaying/
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ test.yaml        # CI/CDãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go          # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ frontend/                # React ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/           # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.tsx    # ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”‚   â””â”€â”€ Dashboard.tsx# ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ test/            # ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”‚   â”œâ”€â”€ setup.ts     # ãƒ†ã‚¹ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â”‚   â”‚   â””â”€â”€ test-utils.tsx # ã‚«ã‚¹ã‚¿ãƒ render
â”‚   â”‚   â”œâ”€â”€ api.ts           # API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ api.test.ts      # APIãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ App.tsx          # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”‚   â”œâ”€â”€ App.test.tsx     # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ main.tsx         # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ auth/                # èªè¨¼ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â”œâ”€â”€ auth.go          # JWT, PKCE, ãƒˆãƒ¼ã‚¯ãƒ³ãƒãƒƒã‚·ãƒ¥
â”‚   â”‚   â””â”€â”€ auth_test.go     # èªè¨¼ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ handler/             # HTTPãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”‚   â”œâ”€â”€ handler.go       # å…±é€šãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ handler_test.go  # ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ note.go          # Misskey ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
â”‚   â”‚   â”œâ”€â”€ tweet.go         # Twitter ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
â”‚   â”‚   â”œâ”€â”€ status.go        # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ spotify_auth.go  # Spotify OAuthï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ miauth.go        # MiAuth ãƒ•ãƒ­ãƒ¼
â”‚   â”‚   â”œâ”€â”€ twitter_auth.go  # Twitter OAuth 2.0 PKCE
â”‚   â”‚   â”œâ”€â”€ api_post.go      # API ç›´æ¥æŠ•ç¨¿
â”‚   â”‚   â””â”€â”€ settings.go      # ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®š
â”‚   â”œâ”€â”€ metrics/             # Prometheusãƒ¡ãƒˆãƒªã‚¯ã‚¹
â”‚   â”‚   â”œâ”€â”€ metrics.go
â”‚   â”‚   â”œâ”€â”€ metrics_test.go  # ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ middleware.go
â”‚   â”œâ”€â”€ spotify/             # Spotify APIé–¢é€£
â”‚   â”‚   â”œâ”€â”€ auth.go          # OAuthèªè¨¼ï¼ˆå‹å®šç¾©ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth_test.go     # èªè¨¼ãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ client.go        # APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ client_test.go   # ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ player.go        # å†ç”Ÿæƒ…å ±å–å¾—ãƒ»ã‚·ã‚§ã‚¢URLç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ player_test.go   # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ store/               # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
â”‚       â””â”€â”€ store.go         # PostgreSQL æ“ä½œ
â”œâ”€â”€ migrations/              # DBãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ 001_create_users.up.sql
â”‚   â””â”€â”€ 001_create_users.down.sql
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ go.mod
â””â”€â”€ README.md
```

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã§å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã®æ‰‹é †ã«å¾“ã£ã¦ãã ã•ã„ã€‚

### 1. ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
git clone https://github.com/Soli0222/spotify-now-playing.git
cd spotify-now-playing
```

### 2. ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š

```bash
cp .env.example .env
```

```.env
# åŸºæœ¬è¨­å®š
PORT=8080                        # èµ·å‹•ã™ã‚‹ãƒãƒ¼ãƒˆç•ªå·
METRICS_PORT=9090                # ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒãƒ¼ãƒˆç•ªå·ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 9090ï¼‰
SERVER_URI=example.tld           # ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå…ˆã‚µãƒ¼ãƒãƒ¼ã®ãƒ‰ãƒ¡ã‚¤ãƒ³
BASE_URL=https://example.tld     # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ™ãƒ¼ã‚¹URL

# Spotify API
SPOTIFY_CLIENT_ID=xxxxxxxx       # Spotify ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID
SPOTIFY_CLIENT_SECRET=xxxxx      # Spotify ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆAPIç›´æ¥æŠ•ç¨¿æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
DATABASE_URL=postgres://user:password@localhost:5432/spotify_nowplaying?sslmode=disable

# JWTï¼ˆAPIç›´æ¥æŠ•ç¨¿æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
JWT_SECRET=your-secret-key       # JWTç½²åç”¨ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ

# ãƒˆãƒ¼ã‚¯ãƒ³æš—å·åŒ–ï¼ˆæ¨å¥¨ï¼‰
TOKEN_ENCRYPTION_KEY=xxxxxxxx    # 32ãƒã‚¤ãƒˆã®æš—å·åŒ–ã‚­ãƒ¼ï¼ˆAES-256ï¼‰

# Twitter APIï¼ˆTwitteré€£æºã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰
TWITTER_CLIENT_ID=xxxxxxxx       # Twitter ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆID
TWITTER_CLIENT_SECRET=xxxxx      # Twitter ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
```

> **æš—å·åŒ–ã‚­ãƒ¼ã®ç”Ÿæˆæ–¹æ³•:**
> ```bash
> # OpenSSLã‚’ä½¿ç”¨
> openssl rand -base64 32 | head -c 32
> 
> # ã¾ãŸã¯ã€Goã§ç”Ÿæˆ
> go run -e 'package main; import ("crypto/rand"; "fmt"; "io"); func main() { b := make([]byte, 32); io.ReadFull(rand.Reader, b); fmt.Printf("%s", b) }'
> ```

### 3. OAuthè¨­å®š

#### Spotify Developer Dashboard

ä»¥ä¸‹ã®Callback URIã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ï¼š

- `{BASE_URL}/note/callback`
- `{BASE_URL}/tweet/callback`
- `{BASE_URL}/api/auth/spotify/callback`

#### X (Twitter) Developer Portal

ä»¥ä¸‹ã®Callback URLã‚’ç™»éŒ²ã—ã¦ãã ã•ã„ï¼š

- `{BASE_URL}/api/twitter/callback`

### 4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ï¼ˆé–‹ç™ºæ™‚ï¼‰

```bash
cd frontend
pnpm install
pnpm build
cd ..
```

### 5. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆAPIç›´æ¥æŠ•ç¨¿æ©Ÿèƒ½ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆï¼‰

PostgreSQLã‚’èµ·å‹•ã—ã€ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

Docker Composeã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯è‡ªå‹•çš„ã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã•ã‚Œã¾ã™ã€‚

## å®Ÿè¡Œ

### é–‹ç™ºç’°å¢ƒ

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®ã¿ï¼ˆãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ©Ÿèƒ½ã®ã¿ï¼‰
go run ./cmd/server

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
cd frontend
pnpm dev
```

### Docker Composeï¼ˆæ¨å¥¨ï¼‰

```bash
docker compose up -d
```

ã“ã‚Œã«ã‚ˆã‚Šä»¥ä¸‹ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ã¾ã™ï¼š
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒãƒ¼ãƒˆ8080ï¼‰
- PostgreSQLï¼ˆãƒãƒ¼ãƒˆ5432ï¼‰
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ï¼ˆãƒãƒ¼ãƒˆ9090ï¼‰

## ãƒ“ãƒ«ãƒ‰

### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰

```bash
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
cd frontend
pnpm install
pnpm build
cd ..

# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
go build -o server ./cmd/server
./server
```

### ãƒãƒ«ãƒã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£Dockerã‚¤ãƒ¡ãƒ¼ã‚¸

```bash
docker buildx build --platform linux/amd64,linux/arm64 -t your-registry/spotify-nowplaying:latest --push .
```

## ãƒ†ã‚¹ãƒˆ

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
go test -v ./...

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆä»˜ãã§å®Ÿè¡Œ
go test -v -race -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ

```bash
cd frontend

# ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pnpm test:run

# ã‚¦ã‚©ãƒƒãƒãƒ¢ãƒ¼ãƒ‰ã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
pnpm test

# ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆä»˜ãã§å®Ÿè¡Œ
pnpm test:coverage
```

### Lint

```bash
# ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
go vet ./...
golangci-lint run

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
cd frontend
pnpm lint
pnpm tsc -b  # å‹ãƒã‚§ãƒƒã‚¯
```

## CI/CD

GitHub Actionsã‚’ä½¿ç”¨ã—ã¦ã€ã™ã¹ã¦ã®ãƒ—ãƒƒã‚·ãƒ¥ã¨ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§è‡ªå‹•ãƒ†ã‚¹ãƒˆãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

| ã‚¸ãƒ§ãƒ– | èª¬æ˜ |
|---|---|
| `test` | Goã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ |
| `lint` | golangci-lintã«ã‚ˆã‚‹é™çš„è§£æ |
| `frontend-test` | Vitestã«ã‚ˆã‚‹ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆ |
| `frontend-lint` | ESLint + TypeScriptå‹ãƒã‚§ãƒƒã‚¯ |
| `build` | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ»ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ãƒ“ãƒ«ãƒ‰ç¢ºèª |

## API

### ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---|---|
| `GET /note` | Spotifyèªè¨¼ â†’ Misskeyã‚·ã‚§ã‚¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ |
| `GET /tweet` | Spotifyèªè¨¼ â†’ Twitterã‚·ã‚§ã‚¢ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ |

### ç›´æ¥æŠ•ç¨¿API

| ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ |
|---|---|
| `GET /api/post/:token` | APIãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã£ã¦ç›´æ¥æŠ•ç¨¿ |

#### ã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å€¤ | èª¬æ˜ |
|---|---|---|
| `target` | `misskey`, `twitter`, `both` | æŠ•ç¨¿å…ˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `both`ï¼‰ |

#### ãƒ˜ãƒƒãƒ€ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ãƒ˜ãƒƒãƒ€ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¨­å®šã—ãŸå ´åˆã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã«å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```
X-API-Token: your-header-token
```

#### ä½¿ç”¨ä¾‹

```bash
# Misskeyã®ã¿ã«æŠ•ç¨¿
curl "https://example.tld/api/post/your-api-token?target=misskey"

# ä¸¡æ–¹ã«æŠ•ç¨¿ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ãƒˆãƒ¼ã‚¯ãƒ³èªè¨¼ã‚ã‚Šï¼‰
curl -H "X-API-Token: your-header-token" "https://example.tld/api/post/your-api-token"
```

## ãƒ¡ãƒˆãƒªã‚¯ã‚¹

Prometheusãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¯åˆ¥ãƒãƒ¼ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 9090ï¼‰ã® `/metrics` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å…¬é–‹ã•ã‚Œã¾ã™ã€‚

### åˆ©ç”¨å¯èƒ½ãªãƒ¡ãƒˆãƒªã‚¯ã‚¹

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹å | ã‚¿ã‚¤ãƒ— | ãƒ©ãƒ™ãƒ« | èª¬æ˜ |
|---|---|---|---|
| `http_requests_total` | Counter | method, path, status | HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆç·æ•° |
| `http_request_duration_seconds` | Histogram | method, path | HTTPãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†æ™‚é–“ |
| `spotify_api_requests_total` | Counter | endpoint, status | Spotify APIãƒªã‚¯ã‚¨ã‚¹ãƒˆç·æ•° |
| `spotify_api_request_duration_seconds` | Histogram | endpoint | Spotify APIå¿œç­”æ™‚é–“ |
| `share_redirects_total` | Counter | platform, content_type | ã‚·ã‚§ã‚¢ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆæ•° |
| `oauth_callbacks_total` | Counter | platform, status | OAuthã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯æ•° |

## ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯MITãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ä¸‹ã§å…¬é–‹ã•ã‚Œã¦ã„ã¾ã™ã€‚è©³ç´°ã¯LICENSEãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã”è¦§ãã ã•ã„ã€‚
